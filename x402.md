# x402 Integration for OpenClaw

Wire up x402 payment APIs so your agent can make USDC payments on Base.

## Prerequisites

- OpenClaw installed and running
- For **EC2**: Complete [`./EC2.md`](./EC2.md) first, SSH access configured
- For **Local**: Node.js 18+ installed
- For **Other Remote**: SSH access to your server

## Overview

OpenClaw doesn't natively support MCP servers yet. We bridge this using:

1. **mcporter** - CLI tool to call MCP servers
2. **@x402scan/mcp** - MCP server for x402 payment protocol
3. **AgentSkills** - Teach the agent how to use x402 tools

## 1. Install mcporter

### EC2 Users
SSH into your EC2 instance first:
```bash
ssh ubuntu@<your-ec2-ip>
```

### Other Remote Server Users
SSH into your server first:
```bash
ssh <user>@<your-server-ip>
```

### All Environments
Install mcporter globally:
```bash
sudo npm install -g mcporter
```

(On macOS, you may not need `sudo` if using nvm or homebrew-managed Node.js)

## 2. Configure @x402scan/mcp

Add the x402 MCP server to mcporter:

```bash
mcporter config add x402 \
  --command "npx" \
  --arg "-y" \
  --arg "@x402scan/mcp@latest" \
  --scope home
```

Verify it works:

```bash
mcporter call x402 check_balance
```

This creates a wallet at `~/.x402scan-mcp/wallet.json` and shows your address + balance.

## 3. Install x402 Skills

Skills teach the agent how to use mcporter for x402 operations. The `skills` CLI is fetched automatically via npx:

```bash
npx skills add merit-systems/x402scan-skills --global --all --yes
```

This downloads skills to `~/.skills/`.

This installs skills for:
- Wallet management (check balance, get address)
- Data enrichment (people search, org search)
- Web research (Exa search, Firecrawl scrape)
- Image/video generation (StableStudio)

## 4. Link Skills to Workspace

Create a symlink so OpenClaw finds the skills:

```bash
mkdir -p ~/.openclaw/workspace
ln -sf ~/.skills ~/.openclaw/workspace/skills
```

## 5. Restart OpenClaw

### Using the CLI (recommended)
```bash
# If using the daemon installed via `openclaw onboard --install-daemon`:
systemctl --user restart openclaw-gateway

# Check status
openclaw gateway status
```

### EC2/Remote (if using system-level systemd)
```bash
sudo systemctl restart openclaw
```

### Local Machine (manual run)
Stop any running OpenClaw process (Ctrl+C) and restart it:
```bash
openclaw gateway --port 18789
```

## 6. Verify

### Using the CLI (recommended)
```bash
# Check gateway status and loaded skills
openclaw status --deep

# View logs for skill loading messages
openclaw logs --follow
```

### Via journalctl (if using user-level daemon)
```bash
journalctl --user -u openclaw-gateway -n 50 --no-pager | grep -i skill
```

## 7. Fund Your Wallet

Your x402 wallet needs USDC on Base to make paid API calls.

Get your wallet address:
```bash
mcporter call x402 check_balance
```

Send USDC (Base) to the displayed address. Even $5-10 is enough for testing.

## Usage

Once funded, your agent can:

```
"Search for information about Sam Ragsdale"
"Generate an image of a robot"
"Scrape the content from https://example.com"
```

The agent will use mcporter to call @x402scan/mcp, which handles USDC payments automatically.

## Available x402 Resources

| Resource | Provider | Cost |
|----------|----------|------|
| People/Org search | EnrichX402 | ~$0.01-0.05 |
| Google Maps | EnrichX402 | ~$0.01 |
| Twitter/X search | Grok | ~$0.01 |
| Web search | Exa | ~$0.01 |
| Web scrape | Firecrawl | ~$0.01 |
| Image generation | StableStudio | ~$0.04-0.25 |
| Video generation | StableStudio | ~$0.34-3.00 |

## Troubleshooting

### mcporter not found
```bash
# Check installation
which mcporter

# Reinstall if needed
sudo npm install -g mcporter
```

### Wallet not created
```bash
# Force wallet creation
mcporter call x402 check_balance

# Check wallet file exists
ls -la ~/.x402scan-mcp/wallet.json
```

### Skills not loading
```bash
# Check symlink
ls -la ~/.openclaw/workspace/skills

# Recreate if broken
rm ~/.openclaw/workspace/skills
ln -sf ~/.skills ~/.openclaw/workspace/skills

# Restart gateway using CLI
systemctl --user restart openclaw-gateway

# Check status
openclaw status --deep
```

### Insufficient balance
```bash
# Check balance
mcporter call x402 check_balance

# Fund with USDC on Base network
```

## Security Notes

- Your x402 wallet private key is stored at `~/.x402scan-mcp/wallet.json`
- Back up this file if you fund it with significant USDC
- The wallet is only accessible to your user account
- Consider using a dedicated wallet with limited funds

---

**Done!** Your OpenClaw agent now has access to x402 payment APIs. Message your Telegram bot to test it.
